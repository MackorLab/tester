<!DOCTYPE html>
<html>
<head>
    <title>Art Generator</title>
</head>
<body>
    <input type="text" id="api-key-input" placeholder="Введите ключ авторизации">
    <input type="text" id="prompt-input" placeholder="Введите запрос на описание картинки">
    <button id="generate-button">Сгенерировать</button>
    <div id="image-container"></div>

    <script>
        document.getElementById("generate-button").addEventListener("click", function () {
            const apiKey = document.getElementById("api-key-input").value;
            const prompt = document.getElementById("prompt-input").value;

            if (apiKey && prompt) {
                query(apiKey, prompt).then(response => {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(response);
                    document.getElementById("image-container").appendChild(img);

                    generateArt();
                });
            } else {
                alert("Пожалуйста, введите ключ авторизации и запрос");
            }
        });

        async function query(apiKey, prompt) {
            const response = await fetch(
                "https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-xl-base-1.0",
                {
                    headers: { Authorization: `Bearer ${apiKey}` },
                    method: "POST",
                    body: JSON.stringify({ "inputs": prompt }),
                }
            );
            const result = await response.blob();
            return result;
        }

        function generateArt() {
            const apiKey = document.getElementById("api-key-input").value;
            const prompt = document.getElementById("prompt-input").value;
            const numberOfPics = '3';

            const bodyInfo = JSON.stringify({
                "key": apiKey,
                "model_id": "midjourney",
                "prompt": prompt,
                "negative_prompt": "((out of frame)), ((extra fingers)), mutated hands, ((poorly drawn hands)), ((poorly drawn face)), (((mutation))), (((deformed))), (((tiling))), ((naked)), ((tile)), ((fleshpile)), ((ugly)), (((abstract))), blurry, ((bad anatomy)), ((bad proportions)), ((extra limbs)), cloned face, (((skinny))), glitchy, ((extra breasts)), ((double torso)), ((extra arms)), ((extra hands)), ((mangled fingers)), ((missing breasts)), (missing lips), ((ugly face)), ((fat)), ((extra legs)), anime",
                "width": "512",
                "height": "512",
                "samples": numberOfPics,
                "num_inference_steps": "30",
                "safety_checker": "no",
                "enhance_prompt": "yes",
                "seed": null,
                "guidance_scale": 7.5,
                "webhook": null,
                "track_id": null
            });

            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: bodyInfo
            };

            fetch('https://stablediffusionapi.com/api/v3/dreambooth', options)
                .then(response => response.json())
                .then(data => {
                    const picAmount = data.output.length;

                    for (let i = 0; i < picAmount; i++) {
                        const imageUrl = data.output[i];
                        const img = document.createElement('img');
                        img.src = imageUrl;
                        document.getElementById("image-container").appendChild(img);
                    }
                })
                .catch(error => {
                    console.error(error);
                });
        }
    </script>
</body>
</html>

