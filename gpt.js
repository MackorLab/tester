!function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(o,l,function(t){return e[t]}.bind(null,l));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n;var o,l="";vkBridge.send("VKWebAppInit");var a=s("sky");function s(e){var t=String(document.location.href).split("?");if(t[1]){var n=t[1].split("&");for(y=0;y<n.length;y++){var o=n[y].split("=");if(o[0]==e&&o[1])return o[1]}}return""}var c=s("keys");function s(e){var t=String(document.location.href).split("?");if(t[1]){var n=t[1].split("&");for(y=0;y<n.length;y++){var o=n[y].split("=");if(o[0]==e&&o[1])return o[1]}}return""}vkBridge.send("VKWebAppGetUserInfo").then(e=>{console.log(e.id),console.log(e.first_name),console.log(e.last_name),console.log(e),o=e.id,e.id,l=e.photo_100,console.log(l),fetch("https://skyauto.me/cllbck/"+a+"?api=1&uid="+c+"&sid_man="+o).then((function(e){return e.json()})).then((function(e){console.log(e);var t=e.status;(console.log("Статус:",t),t>0)&&(document.getElementById("focusis").style.display="none",d())})).catch((function(e){console.log(e)})),console.log(code_hash)}).catch(e=>{});const r=document.getElementById("darkMode_H_T");function d(){Y.innerHTML="",pe()}var i;r.addEventListener("change",d);const u=new URL(window.location.href).searchParams.get("key"),m=$("#apiKey");function g(e){localStorage.setItem("apiKey",e),i=e,console.log(i)}u?(m.val(u),g(u)):function(){const e=localStorage.getItem("apiKey");e&&(m.val(e),i=e,console.log(i))}(),m.on("input",()=>{g(m.val())}),m.attr("type","password");document.getElementById("totTokBut").addEventListener("click",(function(){const e=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1});e.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(t=>{t.isConfirmed?e.fire("Deleted!","Your file has been deleted.","success"):(localStorage.setItem("totalTokens","0"),re.textContent="0",t.dismiss===Swal.DismissReason.cancel&&e.fire("Cancelled","Your imaginary file is safe :)","error"))})}));var p,y,v,f,h,E,I,S="https://i.ibb.co/QJgmw60/GPT.gif",B=document.getElementById("avatarUrl");for(localStorage.getItem("avatarUrl")&&(B.value=localStorage.getItem("avatarUrl"),S=B.value),B.addEventListener("input",(function(){localStorage.setItem("avatarUrl",B.value),S=B.value})),p=document.getElementsByClassName("custom-select"),y=0;y<p.length;y++){for(f=p[y].getElementsByTagName("select")[0],(h=document.createElement("DIV")).setAttribute("class","select-selected"),h.innerHTML=f.options[f.selectedIndex].innerHTML,p[y].appendChild(h),(E=document.createElement("DIV")).setAttribute("class","select-items select-hide"),v=1;v<f.length;v++)(I=document.createElement("DIV")).innerHTML=f.options[v].innerHTML,I.addEventListener("click",(function(e){var t,n,o,l,a;for(l=this.parentNode.parentNode.getElementsByTagName("select")[0],a=this.parentNode.previousSibling,n=0;n<l.length;n++)if(l.options[n].innerHTML==this.innerHTML){for(l.selectedIndex=n,a.innerHTML=this.innerHTML,t=this.parentNode.getElementsByClassName("same-as-selected"),o=0;o<t.length;o++)t[o].removeAttribute("class");this.setAttribute("class","same-as-selected");break}a.click()})),E.appendChild(I);p[y].appendChild(E),h.addEventListener("click",(function(e){e.stopPropagation(),k(this),this.nextSibling.classList.toggle("select-hide"),this.classList.toggle("select-arrow-active")}))}function k(e){var t,n,o,l=[];for(t=document.getElementsByClassName("select-items"),n=document.getElementsByClassName("select-selected"),o=0;o<n.length;o++)e==n[o]?l.push(o):n[o].classList.remove("select-arrow-active");for(o=0;o<t.length;o++)l.indexOf(o)&&t[o].classList.add("select-hide")}document.addEventListener("click",k);var b="###";var x,C=localStorage.getItem("savedInput");C&&(document.getElementById("frazSend").value=C),document.getElementById("frazSend").addEventListener("input",(function(){var e;e=document.getElementById("frazSend").value,localStorage.setItem("savedInput",e),document.getElementById("frazSendOut").textContent=this.value,b=this.value,console.log(b)})),window.addEventListener("load",(function(){var e=localStorage.getItem("savedInput");e?(document.getElementById("frazSend").value=e,document.getElementById("frazSendOut").textContent=e,b=e):(document.getElementById("frazSend").value=b,document.getElementById("frazSendOut").textContent=b)}));const L=document.querySelector("#languageSelect"),w=()=>{localStorage.setItem("language",L.value),x=L.value,console.log(x)};(()=>{const e=localStorage.getItem("language");e&&(L.value=e,x=e,console.log(x))})(),w(),L.addEventListener("change",()=>{w()});const T=document.querySelector("#formControlTemp"),_=document.querySelector("#rangeTemp"),P=document.querySelector("#formControlTop_P"),A=document.querySelector("#rangeTop_P"),F=()=>{localStorage.setItem("rangeValue",T.value),localStorage.setItem("rangeValue2",P.value)};(()=>{const e=localStorage.getItem("rangeValue"),t=localStorage.getItem("rangeValue2");e&&(T.value=e,_.textContent=e),t&&(P.value=t,A.textContent=t)})(),T.addEventListener("input",()=>{_.textContent=T.value,F()}),P.addEventListener("input",()=>{A.textContent=P.value,F()});const N=document.querySelector("#maxTokensInput"),O=document.querySelector("#maxTokensValue"),M=localStorage.getItem("maxTokens");M?(N.value=M,O.textContent=M):O.textContent=N.value,N.addEventListener("input",()=>{O.textContent=N.value,localStorage.setItem("maxTokens",N.value)});const H=document.querySelector("#stopWordInput"),q=document.querySelector("#stopWordValue"),V=localStorage.getItem("stopWord");if(V)H.value=V,q.textContent=V;else{const e=H.value;q.textContent=e}H.addEventListener("input",()=>{const e=H.value;q.textContent=e,localStorage.setItem("stopWord",e)});document.getElementById("dend_nam").addEventListener("click",e=>{e.preventDefault(),window.open("https://finevpn.org/vpn-dlya-chatgpt-besplatnyj/","_blank")||window.location.replace("https://finevpn.org/vpn-dlya-chatgpt-besplatnyj/")});const j=document.querySelector("#fontSelect"),D=localStorage.getItem("selectedFont");D&&(j.value=D,document.body.style.fontFamily=D),j.addEventListener("change",(function(){const e=j.value;document.body.style.fontFamily=e,localStorage.setItem("selectedFont",e)}));const U=document.getElementById("modelSelect");U.addEventListener("change",(function(){const e=U.value;localStorage.setItem("selectedModel",e)})),window.addEventListener("load",(function(){const e=localStorage.getItem("selectedModel");e&&(U.value=e)}));const z=document.getElementById("messageSys"),R=localStorage.getItem("instruction_sys");z.value=R||"Выполнять только инструкции - user",z.addEventListener("input",e=>{const t=e.target.value.trim();localStorage.setItem("instruction_sys",t)});var J=document.getElementById("promOverlay"),K=document.getElementById("codePenOverlay"),W=document.getElementById("bpmOverlay");document.getElementById("showPromButton").addEventListener("click",(function(){J.style.display="block"})),document.getElementById("closeProm").addEventListener("click",(function(){J.style.display="none"})),document.getElementById("showCodePenButton").addEventListener("click",(function(){K.style.display="block"})),document.getElementById("closePen").addEventListener("click",(function(){K.style.display="none"})),document.getElementById("bpmPromButton").addEventListener("click",(function(){W.style.display="block"})),document.getElementById("closeBpm").addEventListener("click",(function(){W.style.display="none"}));var G=document.getElementById("loaders");const Y=document.getElementById("chat"),Q=document.getElementById("messageInput"),Z=document.getElementById("sendButton"),X=document.getElementById("outProm"),ee=document.getElementById("basePageCount");document.createElement("div");let te=[];const ne=document.querySelector("#maxLemInput"),oe=document.querySelector("#maxLemValue"),le=localStorage.getItem("maxLem");function ae(e,t,n,o=!1){const a=document.createElement("div");a.className="message "+t;const s=document.createElement("div");s.className="message-card";const c=document.createElement("img");c.className="avatar",c.src=n?S:l,c.alt=n?"Assistant Avatar":"User Avatar",s.appendChild(c);const r=document.createElement("div");r.className="message-content";const d=document.createElement("p");if(d.className="message-text",r.appendChild(d),s.appendChild(r),a.appendChild(s),Y.appendChild(a),n){const t=e.replace(/\\n/g,"\n").replace(/\*\*([^*]+)\*\*/g,'<span class="bold">$1</span>').replace(/(?:\r\n|\r|\n)/g,"<br>");d.innerHTML=t,d.querySelectorAll(".bold").forEach(e=>{e.style.fontWeight="bold"})}else d.innerHTML=e;ce(),Q.value=""}function se(e,t,n,o=!1){const a=document.createElement("div");a.className="message "+t;const s=document.createElement("div");s.className="message-card";const c=document.createElement("img");c.className="avatar",c.src=n?S:l,c.alt=n?"Assistant Avatar":"User Avatar",s.appendChild(c);const r=document.createElement("div");r.className="message-content";const d=document.createElement("p");if(d.className="message-text",r.appendChild(d),s.appendChild(r),a.appendChild(s),Y.appendChild(a),n){const t=e.replace(/\\n/g,"\n").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/(?:\r\n|\r|\n)/g,"\n");d.textContent=t}else d.textContent=e;ce()}le?(ne.value=le,oe.textContent=le):oe.textContent=ne.value,ne.addEventListener("input",()=>{oe.textContent=ne.value,localStorage.setItem("maxLem",ne.value)});function ce(){Y.scrollTop=Y.scrollHeight}const re=document.getElementById("totalTok");let de=localStorage.getItem("totalTokens");de=parseInt(de)||0,re.textContent=de.toString();var ie,ue="К сожалению воспроизвести можно только ответ сервера от Chat  GPT.";async function me(){const e=parseFloat(T.value),t=parseFloat(P.value),n=q.textContent,o=parseInt(N.value),l=document.getElementById("messageInput"),a=document.getElementById("maxLemInput"),s=document.getElementById("chat");let c=JSON.parse(localStorage.getItem("basePage"))||[];const d=l.value.trim(),u=2*parseInt(a.value);if(l.value="",l.style.height="auto",""===d)return;c.push({role:"user",content:d});let m=[];console.log("Step1:",m),0===u||0===c.length?(m=[{role:"user",content:d}],console.log("Step2:",m)):u>0&&u<=c.length?(m=c.slice(-u),console.log("Step3:",m)):u>c.length&&(console.log("Step4:",m),m=c),console.log("Step5:",m);const g=document.getElementById("messageSys").value.trim(),p=[...m];p.splice(p.length-1,0,{role:"system",content:g}),console.log("Step6:",p),r.checked?se(d,"user",!1):ae(d,"user",!1),G.style.display="block";const y=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({model:"gpt-3.5-turbo-16k",messages:p,temperature:e,top_p:t,stop:n,max_tokens:o})}),v=await y.json();console.log("Отправленное сообщение:",p),console.log("Ответ сервера:",v);const f=v.choices[0].message.content;ue=f,c.push({role:"assistant",content:f}),localStorage.setItem("basePage",JSON.stringify(c)),r.checked?se(f,"assistant",!0):ae(f,"assistant",!0);const h=v.usage.prompt_tokens,E=v.usage.completion_tokens,I=v.usage.total_tokens,S=document.getElementById("outPromB"),B=document.getElementById("outComB"),k=document.getElementById("outTotB");S.textContent=h.toString(),B.textContent=E.toString(),k.textContent=I.toString();let b=localStorage.getItem("totalTokens");b=parseInt(b)||0;const x=b+I;localStorage.setItem("totalTokens",x.toString()),re.textContent=x.toString(),s.scrollTop=s.scrollHeight,G.style.display="none",ge()}function ge(){const e=JSON.parse(localStorage.getItem("basePage"))||[];ee.textContent=e.length.toString(),(n=e.length.toString())>500?X.classList.add("btn","btn-danger"):n>300?X.classList.add("btn","btn-warning"):X.classList.add("btn","btn-outline-primary")}function pe(){const e=JSON.parse(localStorage.getItem("basePage"))||[];if(e.length>0){for(const t of e)r.checked?se(t.content,t.role,"assistant"===t.role,!0):ae(t.content,t.role,"assistant"===t.role,!0);crollToBottom()}else{const t="\n \n\nЗдравствуйте, чем могу быть полезен?\n\n\n  \n\n";r.checked?se(t,"received",!0,!0):ae(t,"received",!0,!0),e.push({role:"assistant",content:t}),localStorage.setItem("basePage",JSON.stringify(e))}}Z.addEventListener("click",e=>{e.preventDefault(),me()}),Q.addEventListener("keydown",e=>{"Enter"===e.key&&(e.shiftKey||(Q.value+="\n",e.preventDefault()))}),Q.addEventListener("input",(function(){Q.style.height="auto",Q.style.height=Q.scrollHeight+"px"})),X.addEventListener("click",(function(){Swal.fire({title:"Вы уверены?",text:"Очистка базы данных приведет к удалению всех сообщений!",icon:"warning",showCancelButton:!0,confirmButtonText:"Да, очистить!",cancelButtonText:"Нет, отменить!",reverseButtons:!0}).then(e=>{e.isConfirmed?(localStorage.removeItem("basePage"),te=[],ge(),Y.innerHTML="",pe(),Swal.fire("Очищено!","База сообщений была успешно очищена.","success")):e.dismiss===Swal.DismissReason.cancel&&Swal.fire("Отменено","Очистка базы сообщений отменена.","error")})})),ge();var ye=document.getElementById("messageInput"),ve=(document.getElementById("stopButton"),document.getElementById("submitRec")),fe=(ve=document.getElementById("submitRec"),document.getElementById("recordingIndicator")),he=!1;ve.addEventListener("click",(function(){he?(ie&&(ie.stop(),ie=null),ve.textContent="🎤",fe.style.display="none",fe.classList.remove("blink"),he=!1):(!function(){(ie=new webkitSpeechRecognition).continuous=!0,ie.interimResults=!0,ie.lang=x;var e=document.getElementById("scrollHeightPanel").scrollHeight;console.log("Высота прокрутки:",e),ie.onstart=function(){fe.style.display="inline-block"},ie.onresult=function(e){var t=e.results[e.resultIndex];if(t.isFinal){var n=t[0].transcript;ye.value+=n+" ",new RegExp(b,"i").test(n)&&(console.log("Найдена фраза: ",n),me())}else console.log("Промежуточный результат: ",t[0].transcript)},ie.onerror=function(e){console.log("Ошибка распознавания: ",e.error)},ie.onend=function(){ve.textContent="🎤",fe.style.display="none",fe.classList.remove("blink"),he=!1},ie.start()}(),ve.textContent="❌",fe.style.display="inline-block",fe.classList.add("blink"),he=!0)}));var Ee=document.getElementById("myModal_sd"),Ie=document.getElementsByClassName("close_sd")[0];window.onclick=function(e){e.target!=Ee&&e.target!=Ie||(Ee.style.display="none")},document.getElementById("privacyLink_sd").addEventListener("click",(function(){document.getElementById("privacyModal_sd").style.display="block"})),document.getElementById("dataProcessingLink_sd").addEventListener("click",(function(){document.getElementById("dataProcessingModal_sd").style.display="block"})),document.getElementById("openAiLink_sd").addEventListener("click",(function(){document.getElementById("openAiModal_sd").style.display="block"}));var Se=document.getElementById("privacyModal_sd"),Be=document.getElementById("dataProcessingModal_sd"),ke=document.getElementById("openAiModal_sd"),be=document.getElementById("closePrivacy_sd"),xe=document.getElementById("closeDataProcessing_sd"),Ce=document.getElementById("closeOpenAi_sd");window.onclick=function(e){e.target!=Se&&e.target!=be||(Se.style.display="none"),e.target!=Be&&e.target!=xe||(Be.style.display="none"),e.target!=ke&&e.target!=Ce||(ke.style.display="none")},document.getElementById("myForm_sd").addEventListener("submit",(function(e){var t=document.getElementById("privacyCheckbox_sd").checked,n=document.getElementById("dataProcessingCheckbox_sd").checked,o=document.getElementById("openAiCheckbox_sd").checked;t&&n&&o||(e.preventDefault(),alert("Пожалуйста, ознакомьтесь со всеми политиками перед отправкой формы."))})),document.querySelectorAll(".close_sd").forEach((function(e){e.addEventListener("click",(function(){e.closest(".modal_sd").style.display="none"}))}));var Le=document.getElementById("butSet"),we=0,Te=0;Le.addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("name_sd").value,n=document.getElementById("email_sd").value,o=document.getElementById("phone_sd").value,l=document.querySelector('input[name="product_sd"]:checked');l&&l.value;/^([А-Я]{1}[а-яё]{1,23}|[A-Z]{1}[a-z]{1,23})$/.test(t)?console.log("Имя соответствует"):(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Имени!",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),we=1,console.log("Имя не соответствует требованиям")),/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu.test(n)?console.log("Email соответствует"):(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Email!",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),Te=1,console.log("Email не соответствует требованиям")),!function(e){return/^((8|\+374|\+994|\+995|\+375|\+7|\+380|\+38|\+996|\+998|\+993)[\- ]?)?\(?\d{3,5}\)?[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}(([\- ]?\d{1})?[\- ]?\d{1})?$/.test(e)}(o)?(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Телефон",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),1,console.log("Телефон не соответствует требованиям")):console.log("Телефон соответствует");var a=document.getElementById("privacyCheckbox_sd"),s=document.getElementById("dataProcessingCheckbox_sd"),c=document.getElementById("openAiCheckbox_sd"),r=a.checked,d=s.checked,i=c.checked;if(console.log("Состояние privacyCheckbox:",r),console.log("Состояние dataProcessingCheckbox:",d),console.log("Состояние openAiCheckbox:",i),!r||!d||!i)return Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, ознакомтесь с \n политиками сотрудничиства",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),1,void console.log("Политика не соответствует требованиям");1===we?console.log("Ошибка в имени"):1===Te?console.log("Ошибка в email"):console.log("OK")})),$.get("https://ipinfo.io",(function(e){console.log(e)}),"jsonp");const _e=document.getElementById("voice"),Pe=document.getElementById("pitch"),Ae=document.getElementById("pitch2"),Fe=document.getElementById("rate"),Ne=document.getElementById("volume"),Oe=document.getElementById("pitchOut"),Me=document.getElementById("pitchOut2"),He=document.getElementById("rateOut"),qe=document.getElementById("volumeOut"),Ve=document.getElementById("speak");function je(){Oe.textContent=Pe.value,Me.textContent=Ae.value,He.textContent=Fe.value,qe.textContent=Ne.value}function De(){_e.innerHTML="";const e=window.speechSynthesis.getVoices(),t=e.find(e=>"Google русский"===e.name);t&&(e.splice(e.indexOf(t),1),e.unshift(t)),e.forEach((e,t)=>{const n=document.createElement("option");n.value=e.voiceURI,n.text=e.name,_e.add(n)})}Pe.addEventListener("input",je),Ae.addEventListener("input",je),Fe.addEventListener("input",je),Ne.addEventListener("input",je),Ve.addEventListener("click",(function(){window.speechSynthesis.cancel();const e=ue.split(".");let t=0,n=0;!function o(){if(t<e.length){const l=e[t].trim();if(l){const e=new SpeechSynthesisUtterance(l);e.voice=window.speechSynthesis.getVoices().find(e=>e.voiceURI===_e.value),e.rate=parseFloat(Fe.value),e.volume=parseFloat(Ne.value),e.pitch=n%2==0?parseFloat(Pe.value):parseFloat(Ae.value),e.onend=()=>{t++,o()},window.speechSynthesis.speak(e)}else t++,o();n++}}()})),De(),window.speechSynthesis.onvoiceschanged=De}]);
