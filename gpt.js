!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n,o="";vkBridge.send("VKWebAppInit");var a=l("sky");function l(e){var t=String(document.location.href).split("?");if(t[1]){var n=t[1].split("&");for(i=0;i<n.length;i++){var o=n[i].split("=");if(o[0]==e&&o[1])return o[1]}}return""}var s=l("keys");function l(e){var t=String(document.location.href).split("?");if(t[1]){var n=t[1].split("&");for(i=0;i<n.length;i++){var o=n[i].split("=");if(o[0]==e&&o[1])return o[1]}}return""}vkBridge.send("VKWebAppGetUserInfo").then(e=>{console.log(e.id),console.log(e.first_name),console.log(e.last_name),console.log(e),n=e.id,e.id,o=e.photo_100,console.log(o),fetch("https://skyauto.me/cllbck/"+a+"?api=1&uid="+s+"&sid_man="+n).then((function(e){return e.json()})).then((function(e){console.log(e);var t=e.status;(console.log("Статус:",t),t>0)&&(document.getElementById("focusis").style.display="none",d())})).catch((function(e){console.log(e)})),console.log(code_hash)}).catch(e=>{});const c=document.getElementById("darkMode_H_T");function d(){q.innerHTML="",oe()}var r;c.addEventListener("change",d);const u=new URL(window.location.href).searchParams.get("key"),m=$("#apiKey");function g(e){localStorage.setItem("apiKey",e),r=e,console.log(r)}u?(m.val(u),g(u)):function(){const e=localStorage.getItem("apiKey");e&&(m.val(e),r=e,console.log(r))}(),m.on("input",()=>{g(m.val())}),m.attr("type","password");var p="https://i.ibb.co/QJgmw60/GPT.gif",y=document.getElementById("avatarUrl");localStorage.getItem("avatarUrl")&&(y.value=localStorage.getItem("avatarUrl"),p=y.value),y.addEventListener("input",(function(){localStorage.setItem("avatarUrl",y.value),p=y.value}));var v="###";var h,f=localStorage.getItem("savedInput");f&&(document.getElementById("frazSend").value=f),document.getElementById("frazSend").addEventListener("input",(function(){var e;e=document.getElementById("frazSend").value,localStorage.setItem("savedInput",e),document.getElementById("frazSendOut").textContent=this.value,v=this.value,console.log(v)})),window.addEventListener("load",(function(){var e=localStorage.getItem("savedInput");e?(document.getElementById("frazSend").value=e,document.getElementById("frazSendOut").textContent=e,v=e):(document.getElementById("frazSend").value=v,document.getElementById("frazSendOut").textContent=v)}));const E=document.querySelector("#languageSelect"),I=()=>{localStorage.setItem("language",E.value),h=E.value,console.log(h)};(()=>{const e=localStorage.getItem("language");e&&(E.value=e,h=e,console.log(h))})(),I(),E.addEventListener("change",()=>{I()});const S=document.querySelector("#formControlTemp"),k=document.querySelector("#rangeTemp"),B=document.querySelector("#formControlTop_P"),x=document.querySelector("#rangeTop_P"),b=()=>{localStorage.setItem("rangeValue",S.value),localStorage.setItem("rangeValue2",B.value)};(()=>{const e=localStorage.getItem("rangeValue"),t=localStorage.getItem("rangeValue2");e&&(S.value=e,k.textContent=e),t&&(B.value=t,x.textContent=t)})(),S.addEventListener("input",()=>{k.textContent=S.value,b()}),B.addEventListener("input",()=>{x.textContent=B.value,b()});const C=document.querySelector("#maxTokensInput"),L=document.querySelector("#maxTokensValue"),_=localStorage.getItem("maxTokens");_?(C.value=_,L.textContent=_):L.textContent=C.value,C.addEventListener("input",()=>{L.textContent=C.value,localStorage.setItem("maxTokens",C.value)});const w=document.querySelector("#stopWordInput"),T=document.querySelector("#stopWordValue"),P=localStorage.getItem("stopWord");if(P)w.value=P,T.textContent=P;else{const e=w.value;T.textContent=e}w.addEventListener("input",()=>{const e=w.value;T.textContent=e,localStorage.setItem("stopWord",e)});document.getElementById("dend_nam").addEventListener("click",e=>{e.preventDefault(),window.open("https://finevpn.org/vpn-dlya-chatgpt-besplatnyj/","_blank")||window.location.replace("https://finevpn.org/vpn-dlya-chatgpt-besplatnyj/")});const F=document.querySelector("#fontSelect"),A=localStorage.getItem("selectedFont");A&&(F.value=A,document.body.style.fontFamily=A),F.addEventListener("change",(function(){const e=F.value;document.body.style.fontFamily=e,localStorage.setItem("selectedFont",e)}));const M=document.getElementById("modelSelect");M.addEventListener("change",(function(){const e=M.value;localStorage.setItem("selectedModel",e)})),window.addEventListener("load",(function(){const e=localStorage.getItem("selectedModel");e&&(M.value=e)}));const O=document.getElementById("messageSys"),N=localStorage.getItem("instruction_sys");O.value=N||"Выполнять только инструкции - user",O.addEventListener("input",e=>{const t=e.target.value.trim();localStorage.setItem("instruction_sys",t)}),document.getElementById("CodePen").addEventListener("click",(function(){const e=document.createElement("div");e.innerHTML='\n  <p class="codepen" data-height="300" data-theme-id="dark" data-default-tab="html,result" data-slug-hash="xxQmwRE" data-user="MackorLab" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">\n  <span>See the Pen <a href="https://codepen.io/MackorLab/pen/xxQmwRE">\n  ChatGPT-CodePen_1</a> by VK-ChatGPT-3.5 -Turbo (<a href="https://codepen.io/MackorLab">@MackorLab</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"><\/script>\n  ',document.body.appendChild(e)}));var j=document.getElementById("loaders");const q=document.getElementById("chat"),H=document.getElementById("messageInput"),V=document.getElementById("sendButton"),z=document.getElementById("outProm"),U=document.getElementById("basePageCount");document.createElement("div");let R=[];const K=document.querySelector("#maxLemInput"),J=document.querySelector("#maxLemValue"),W=localStorage.getItem("maxLem");function D(e,t,n,a=!1){const l=document.createElement("div");l.className="message "+t;const s=document.createElement("div");s.className="message-card";const c=document.createElement("img");c.className="avatar",c.src=n?p:o,c.alt=n?"Assistant Avatar":"User Avatar",s.appendChild(c);const d=document.createElement("div");d.className="message-content";const r=document.createElement("p");if(r.className="message-text",d.appendChild(r),s.appendChild(d),l.appendChild(s),q.appendChild(l),n){const t=e.replace(/\\n/g,"\n").replace(/\*\*([^*]+)\*\*/g,'<span class="bold">$1</span>').replace(/(?:\r\n|\r|\n)/g,"<br>");r.innerHTML=t,r.querySelectorAll(".bold").forEach(e=>{e.style.fontWeight="bold"})}else r.innerHTML=e;Q(),H.value=""}function G(e,t,n,a=!1){const l=document.createElement("div");l.className="message "+t;const s=document.createElement("div");s.className="message-card";const c=document.createElement("img");c.className="avatar",c.src=n?p:o,c.alt=n?"Assistant Avatar":"User Avatar",s.appendChild(c);const d=document.createElement("div");d.className="message-content";const r=document.createElement("p");if(r.className="message-text",d.appendChild(r),s.appendChild(d),l.appendChild(s),q.appendChild(l),n){const t=e.replace(/\\n/g,"\n").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/(?:\r\n|\r|\n)/g,"\n");r.textContent=t}else r.textContent=e;Q()}W?(K.value=W,J.textContent=W):J.textContent=K.value,K.addEventListener("input",()=>{J.textContent=K.value,localStorage.setItem("maxLem",K.value)});function Q(){q.scrollTop=q.scrollHeight}const Z=document.getElementById("totalTok");let X=localStorage.getItem("totalTokens");X=parseInt(X)||0,Z.textContent=X.toString();document.getElementById("totTokBut").addEventListener("click",(function(){localStorage.setItem("totalTokens","0"),Z.textContent="0"}));var Y,ee="К сожалению воспроизвести можно только ответ сервера от Chat  GPT. Так же для лучшего воспроизведения, зайдите в настройки и выберете язык озвучки Google    Русский";async function te(){const e=parseFloat(S.value),t=parseFloat(B.value),n=T.textContent,o=parseInt(C.value),a=document.getElementById("messageInput"),l=document.getElementById("maxLemInput"),s=document.getElementById("chat");let d=JSON.parse(localStorage.getItem("basePage"))||[];const i=a.value.trim(),u=2*parseInt(l.value);if(a.value="",a.style.height="auto",""===i)return;d.push({role:"user",content:i});let m=[];console.log("Step1:",m),0===u||0===d.length?(m=[{role:"user",content:i}],console.log("Step2:",m)):u>0&&u<=d.length?(m=d.slice(-u),console.log("Step3:",m)):u>d.length&&(console.log("Step4:",m),m=d),console.log("Step5:",m);const g=document.getElementById("messageSys").value.trim(),p=[...m];p.splice(p.length-1,0,{role:"system",content:g}),console.log("Step6:",p),c.checked?G(i,"user",!1):D(i,"user",!1),j.style.display="block";const y=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+r},body:JSON.stringify({model:"gpt-3.5-turbo-16k",messages:p,temperature:e,top_p:t,stop:n,max_tokens:o})}),v=await y.json();console.log("Отправленное сообщение:",p),console.log("Ответ сервера:",v);const h=v.choices[0].message.content;ee=h,d.push({role:"assistant",content:h}),localStorage.setItem("basePage",JSON.stringify(d)),c.checked?G(h,"assistant",!0):D(h,"assistant",!0);const f=v.usage.prompt_tokens,E=v.usage.completion_tokens,I=v.usage.total_tokens,k=document.getElementById("outPromB"),x=document.getElementById("outComB"),b=document.getElementById("outTotB");k.textContent=f.toString(),x.textContent=E.toString(),b.textContent=I.toString();let L=localStorage.getItem("totalTokens");L=parseInt(L)||0;const _=L+I;localStorage.setItem("totalTokens",_.toString()),Z.textContent=_.toString(),s.scrollTop=s.scrollHeight,j.style.display="none",ne()}function ne(){const e=JSON.parse(localStorage.getItem("basePage"))||[];U.textContent=e.length.toString()}function oe(){const e=JSON.parse(localStorage.getItem("basePage"))||[];if(e.length>0){for(const t of e)c.checked?G(t.content,t.role,"assistant"===t.role,!0):D(t.content,t.role,"assistant"===t.role,!0);crollToBottom()}else{const t="\n \n\nЗдравствуйте, чем могу быть полезен?\n\n\n  \n\n";c.checked?G(t,"received",!0,!0):D(t,"received",!0,!0),e.push({role:"assistant",content:t}),localStorage.setItem("basePage",JSON.stringify(e))}}V.addEventListener("click",e=>{e.preventDefault(),te()}),H.addEventListener("keydown",e=>{"Enter"===e.key&&(e.shiftKey||(H.value+="\n",e.preventDefault()))}),H.addEventListener("input",(function(){H.style.height="auto",H.style.height=H.scrollHeight+"px"})),z.addEventListener("click",()=>{localStorage.removeItem("basePage"),R=[],ne(),q.innerHTML="",oe()}),ne();var ae=document.getElementById("messageInput"),le=(document.getElementById("stopButton"),document.getElementById("submitRec")),se=(le=document.getElementById("submitRec"),document.getElementById("recordingIndicator")),ce=!1;le.addEventListener("click",(function(){ce?(Y&&(Y.stop(),Y=null),le.textContent="🎤",se.style.display="none",se.classList.remove("blink"),ce=!1):(!function(){(Y=new webkitSpeechRecognition).continuous=!0,Y.interimResults=!0,Y.lang=h;var e=document.getElementById("scrollHeightPanel").scrollHeight;console.log("Высота прокрутки:",e),Y.onstart=function(){se.style.display="inline-block"},Y.onresult=function(e){var t=e.results[e.resultIndex];if(t.isFinal){var n=t[0].transcript;ae.value+=n+" ",new RegExp(v,"i").test(n)&&(console.log("Найдена фраза: ",n),te())}else console.log("Промежуточный результат: ",t[0].transcript)},Y.onerror=function(e){console.log("Ошибка распознавания: ",e.error)},Y.onend=function(){le.textContent="🎤",se.style.display="none",se.classList.remove("blink"),ce=!1},Y.start()}(),le.textContent="❌",se.style.display="inline-block",se.classList.add("blink"),ce=!0)})),document.getElementById("openModal_sd").addEventListener("click",(function(){document.getElementById("myModal_sd").style.display="block"}));var de=document.getElementById("myModal_sd"),re=document.getElementsByClassName("close_sd")[0];window.onclick=function(e){e.target!=de&&e.target!=re||(de.style.display="none")},document.getElementById("privacyLink_sd").addEventListener("click",(function(){document.getElementById("privacyModal_sd").style.display="block"})),document.getElementById("dataProcessingLink_sd").addEventListener("click",(function(){document.getElementById("dataProcessingModal_sd").style.display="block"})),document.getElementById("openAiLink_sd").addEventListener("click",(function(){document.getElementById("openAiModal_sd").style.display="block"}));var ie=document.getElementById("privacyModal_sd"),ue=document.getElementById("dataProcessingModal_sd"),me=document.getElementById("openAiModal_sd"),ge=document.getElementById("closePrivacy_sd"),pe=document.getElementById("closeDataProcessing_sd"),ye=document.getElementById("closeOpenAi_sd");window.onclick=function(e){e.target!=ie&&e.target!=ge||(ie.style.display="none"),e.target!=ue&&e.target!=pe||(ue.style.display="none"),e.target!=me&&e.target!=ye||(me.style.display="none")},document.getElementById("myForm_sd").addEventListener("submit",(function(e){var t=document.getElementById("privacyCheckbox_sd").checked,n=document.getElementById("dataProcessingCheckbox_sd").checked,o=document.getElementById("openAiCheckbox_sd").checked;t&&n&&o||(e.preventDefault(),alert("Пожалуйста, ознакомьтесь со всеми политиками перед отправкой формы."))})),document.querySelectorAll(".close_sd").forEach((function(e){e.addEventListener("click",(function(){e.closest(".modal_sd").style.display="none"}))}));var ve=document.getElementById("butSet"),he=0,fe=0;ve.addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("name_sd").value,n=document.getElementById("email_sd").value,o=document.getElementById("phone_sd").value,a=document.querySelector('input[name="product_sd"]:checked');a&&a.value;/^([А-Я]{1}[а-яё]{1,23}|[A-Z]{1}[a-z]{1,23})$/.test(t)?console.log("Имя соответствует"):(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Имени!",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),he=1,console.log("Имя не соответствует требованиям")),/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu.test(n)?console.log("Email соответствует"):(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Email!",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),fe=1,console.log("Email не соответствует требованиям")),!function(e){return/^((8|\+374|\+994|\+995|\+375|\+7|\+380|\+38|\+996|\+998|\+993)[\- ]?)?\(?\d{3,5}\)?[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}(([\- ]?\d{1})?[\- ]?\d{1})?$/.test(e)}(o)?(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Телефон",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),1,console.log("Телефон не соответствует требованиям")):console.log("Телефон соответствует");var l=document.getElementById("privacyCheckbox_sd"),s=document.getElementById("dataProcessingCheckbox_sd"),c=document.getElementById("openAiCheckbox_sd"),d=l.checked,r=s.checked,i=c.checked;if(console.log("Состояние privacyCheckbox:",d),console.log("Состояние dataProcessingCheckbox:",r),console.log("Состояние openAiCheckbox:",i),!d||!r||!i)return Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, ознакомтесь с \n политиками сотрудничиства",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),1,void console.log("Политика не соответствует требованиям");1===he?console.log("Ошибка в имени"):1===fe?console.log("Ошибка в email"):console.log("OK")})),$.get("https://ipinfo.io",(function(e){console.log(e)}),"jsonp");const Ee=document.getElementById("voice"),Ie=document.getElementById("pitch"),Se=document.getElementById("rate"),ke=document.getElementById("volume"),Be=document.getElementById("pitchOut"),xe=document.getElementById("rateOut"),be=document.getElementById("volumeOut"),Ce=document.getElementById("speak");function Le(){Be.textContent=Ie.value,xe.textContent=Se.value,be.textContent=ke.value}function _e(){Ee.innerHTML="",window.speechSynthesis.getVoices().forEach(e=>{const t=document.createElement("option");t.value=e.voiceURI,t.text=e.name,Ee.add(t)})}Ie.addEventListener("input",Le),Se.addEventListener("input",Le),ke.addEventListener("input",Le),Ce.addEventListener("click",(function(){window.speechSynthesis.cancel();const e=ee.split(".");let t=0;!function n(){if(t<e.length){const o=e[t].trim();if(o){const e=new SpeechSynthesisUtterance(o);e.voice=window.speechSynthesis.getVoices().find(e=>e.voiceURI===Ee.value),e.pitch=parseFloat(Ie.value),e.rate=parseFloat(Se.value),e.volume=parseFloat(ke.value),e.onend=()=>{t++,n()},window.speechSynthesis.speak(e)}else t++,n()}}()})),_e(),window.speechSynthesis.onvoiceschanged=_e}]);
