!function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(o,l,function(t){return e[t]}.bind(null,l));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n=document.getElementById("wrapp");var o,l="https://sun4-20.userapi.com/s/v1/ig2/3lYfWDkwWRgJcL7IxG-_dLgDj4AjYWEI6Uu3VOe2SAfnvjW3bCaMurDY3F9koJedu2lJwfQjdEayrPFhTJ7R1zzE.jpg?size=100x100&quality=95&crop=95,0,379,379&ava=1";vkBridge.send("VKWebAppInit");var a=c("sky");function c(e){var t=String(document.location.href).split("?");if(t[1]){var n=t[1].split("&");for(i=0;i<n.length;i++){var o=n[i].split("=");if(o[0]==e&&o[1])return o[1]}}return""}var s=c("keys");function c(e){var t=String(document.location.href).split("?");if(t[1]){var n=t[1].split("&");for(i=0;i<n.length;i++){var o=n[i].split("=");if(o[0]==e&&o[1])return o[1]}}return""}vkBridge.send("VKWebAppGetUserInfo").then(e=>{console.log(e.id),console.log(e.first_name),console.log(e.last_name),console.log(e),o=e.id,e.id,l=e.photo_100,console.log(l),fetch("https://skyauto.me/cllbck/"+a+"?api=1&uid="+s+"&sid_man="+o).then((function(e){return e.json()})).then((function(e){console.log(e);var t=e.status;(console.log("Статус:",t),t>0)&&(document.getElementById("focusis").style.display="none",n.style.display="none",d())})).catch((function(e){console.log(e)})),console.log(code_hash)}).catch(e=>{});const r=document.getElementById("darkMode_H_T");function d(){M.innerHTML="",Z()}var u;r.addEventListener("change",d);const m=new URL(window.location.href).searchParams.get("key"),g=$("#apiKey");function p(e){localStorage.setItem("apiKey",e),u=e,console.log(u)}m?(g.val(m),p(m)):function(){const e=localStorage.getItem("apiKey");e&&(g.val(e),u=e,console.log(u))}(),g.on("input",()=>{p(g.val())}),g.attr("type","password");var y="###";var v,f=localStorage.getItem("savedInput");f&&(document.getElementById("frazSend").value=f),document.getElementById("frazSend").addEventListener("input",(function(){var e;e=document.getElementById("frazSend").value,localStorage.setItem("savedInput",e),document.getElementById("frazSendOut").textContent=this.value,y=this.value,console.log(y)})),window.addEventListener("load",(function(){var e=localStorage.getItem("savedInput");e?(document.getElementById("frazSend").value=e,document.getElementById("frazSendOut").textContent=e,y=e):(document.getElementById("frazSend").value=y,document.getElementById("frazSendOut").textContent=y)}));const I=document.querySelector("#languageSelect"),E=()=>{localStorage.setItem("language",I.value),v=I.value,console.log(v)};(()=>{const e=localStorage.getItem("language");e&&(I.value=e,v=e,console.log(v))})(),E(),I.addEventListener("change",()=>{E()});const h=document.querySelector("#formControlTemp"),S=document.querySelector("#rangeTemp"),k=document.querySelector("#formControlTop_P"),B=document.querySelector("#rangeTop_P"),x=()=>{localStorage.setItem("rangeValue",h.value),localStorage.setItem("rangeValue2",k.value)};(()=>{const e=localStorage.getItem("rangeValue"),t=localStorage.getItem("rangeValue2");e&&(h.value=e,S.textContent=e),t&&(k.value=t,B.textContent=t)})(),h.addEventListener("input",()=>{S.textContent=h.value,x()}),k.addEventListener("input",()=>{B.textContent=k.value,x()});const b=document.querySelector("#maxTokensInput"),C=document.querySelector("#maxTokensValue"),_=localStorage.getItem("maxTokens");_?(b.value=_,C.textContent=_):C.textContent=b.value,b.addEventListener("input",()=>{C.textContent=b.value,localStorage.setItem("maxTokens",b.value)});const L=document.querySelector("#stopWordInput"),T=document.querySelector("#stopWordValue"),F=localStorage.getItem("stopWord");if(F)L.value=F,T.textContent=F;else{const e=L.value;T.textContent=e}L.addEventListener("input",()=>{const e=L.value;T.textContent=e,localStorage.setItem("stopWord",e)});const P=document.querySelector("#fontSelect"),A=localStorage.getItem("selectedFont");A&&(P.value=A,document.body.style.fontFamily=A),P.addEventListener("change",(function(){const e=P.value;document.body.style.fontFamily=e,localStorage.setItem("selectedFont",e)}));const w=document.getElementById("modelSelect");w.addEventListener("change",(function(){const e=w.value;localStorage.setItem("selectedModel",e)})),window.addEventListener("load",(function(){const e=localStorage.getItem("selectedModel");e&&(w.value=e)}));var O=document.getElementById("loaders");const M=document.getElementById("chat"),N=document.getElementById("messageInput"),q=document.getElementById("sendButton"),j=document.getElementById("outProm"),z=document.getElementById("basePageCount");document.createElement("div");let J=[];const W=document.querySelector("#maxLemInput"),H=document.querySelector("#maxLemValue"),V=localStorage.getItem("maxLem");V?(W.value=V,H.textContent=V):H.textContent=W.value,W.addEventListener("input",()=>{H.textContent=W.value,localStorage.setItem("maxLem",W.value)});function D(e,t,n,o=!1){const a=document.createElement("div");a.className="message "+t;const c=document.createElement("div");c.className="message-card";const s=document.createElement("img");s.className="avatar",s.src=n?"https://i.ibb.co/QJgmw60/GPT.gif":l,s.alt=n?"Assistant Avatar":"User Avatar",c.appendChild(s);const r=document.createElement("div");r.className="message-content";const d=document.createElement("p");if(d.className="message-text",r.appendChild(d),c.appendChild(r),a.appendChild(c),M.appendChild(a),n){const t=e.replace(/\\n/g,"\n").replace(/\*\*([^*]+)\*\*/g,'<span class="bold">$1</span>').replace(/(?:\r\n|\r|\n)/g,"<br>");d.innerHTML=t,d.querySelectorAll(".bold").forEach(e=>{e.style.fontWeight="bold"})}else d.innerHTML=e;K(),N.value=""}function R(e,t,n,o=!1){const a=document.createElement("div");a.className="message "+t;const c=document.createElement("div");c.className="message-card";const s=document.createElement("img");s.className="avatar",s.src=n?"https://i.ibb.co/QJgmw60/GPT.gif":l,s.alt=n?"Assistant Avatar":"User Avatar",c.appendChild(s);const r=document.createElement("div");r.className="message-content";const d=document.createElement("p");if(d.className="message-text",r.appendChild(d),c.appendChild(r),a.appendChild(c),M.appendChild(a),n){const t=e.replace(/\\n/g,"\n").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/(?:\r\n|\r|\n)/g,"\n");d.textContent=t}else d.textContent=e;K()}function K(){M.scrollTop=M.scrollHeight}const U=document.getElementById("totalTok");let G=localStorage.getItem("totalTokens");G=parseInt(G)||0,U.textContent=G.toString();async function Q(){const e=parseFloat(h.value),t=parseFloat(k.value),n=T.textContent,o=parseInt(b.value),l=document.getElementById("messageInput"),a=document.getElementById("maxLemInput"),c=document.getElementById("chat"),s=JSON.parse(localStorage.getItem("basePage"))||[],d=l.value.trim();let i=[];const m=2*parseInt(a.value);if(l.value="",l.style.height="auto",""===d)return;s.push({role:"user",content:d}),0===m||0===s.length?i=[{role:"user",content:d}]:m>0&&m<=s.length?i=s.slice(-m):m>s.length&&(i=s),r.checked?R(d,"user",!1):D(d,"user",!1),O.style.display="block";const g=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u},body:JSON.stringify({model:"gpt-3.5-turbo-16k",messages:i,temperature:e,top_p:t,stop:n,max_tokens:o})}),p=await g.json();console.log("Отправленное сообщение:",i),console.log("Ответ сервера:",p);const y=p.choices[0].message.content;s.push({role:"assistant",content:y}),localStorage.setItem("basePage",JSON.stringify(s)),r.checked?R(y,"assistant",!0):D(y,"assistant",!0);const v=p.usage.prompt_tokens,f=p.usage.completion_tokens,I=p.usage.total_tokens,E=document.getElementById("outPromB"),S=document.getElementById("outComB"),B=document.getElementById("outTotB");E.textContent=v.toString(),S.textContent=f.toString(),B.textContent=I.toString();let x=localStorage.getItem("totalTokens");x=parseInt(x)||0;const C=x+I;localStorage.setItem("totalTokens",C.toString()),U.textContent=C.toString(),c.scrollTop=c.scrollHeight,O.style.display="none",Y()}function Y(){const e=JSON.parse(localStorage.getItem("basePage"))||[];z.textContent=e.length.toString()}function Z(){const e=JSON.parse(localStorage.getItem("basePage"))||[];if(e.length>0){for(const t of e)r.checked?R(t.content,t.role,"assistant"===t.role,!0):D(t.content,t.role,"assistant"===t.role,!0);crollToBottom()}else{const t="\n \n\nЗдравствуйте, чем могу быть полезен?\n\n\n  \n\n";r.checked?R(t,"received",!0,!0):D(t,"received",!0,!0),e.push({role:"assistant",content:t}),localStorage.setItem("basePage",JSON.stringify(e))}}var X;document.getElementById("totTokBut").addEventListener("click",(function(){localStorage.setItem("totalTokens","0"),U.textContent="0"})),q.addEventListener("click",e=>{e.preventDefault(),Q()}),N.addEventListener("keydown",e=>{"Enter"===e.key&&(e.shiftKey||(N.value+="\n",e.preventDefault()))}),N.addEventListener("input",(function(){N.style.height="auto",N.style.height=N.scrollHeight+"px"})),j.addEventListener("click",()=>{localStorage.removeItem("basePage"),J=[],Y(),M.innerHTML="",Z()}),Y();var ee=document.getElementById("messageInput"),te=(document.getElementById("stopButton"),document.getElementById("submitRec")),ne=(te=document.getElementById("submitRec"),document.getElementById("recordingIndicator")),oe=!1;te.addEventListener("click",(function(){oe?(X&&(X.stop(),X=null),te.textContent="🎤",ne.style.display="none",ne.classList.remove("blink"),oe=!1):(!function(){(X=new webkitSpeechRecognition).continuous=!0,X.interimResults=!0,X.lang=v;var e=document.getElementById("scrollHeightPanel").scrollHeight;console.log("Высота прокрутки:",e),X.onstart=function(){ne.style.display="inline-block"},X.onresult=function(e){var t=e.results[e.resultIndex];if(t.isFinal){var n=t[0].transcript;ee.value+=n+" ",new RegExp(y,"i").test(n)&&(console.log("Найдена фраза: ",n),Q())}else console.log("Промежуточный результат: ",t[0].transcript)},X.onerror=function(e){console.log("Ошибка распознавания: ",e.error)},X.onend=function(){te.textContent="🎤",ne.style.display="none",ne.classList.remove("blink"),oe=!1},X.start()}(),te.textContent="❌",ne.style.display="inline-block",ne.classList.add("blink"),oe=!0)})),document.getElementById("openModal_sd").addEventListener("click",(function(){document.getElementById("myModal_sd").style.display="block"}));var le=document.getElementById("myModal_sd"),ae=document.getElementsByClassName("close_sd")[0];window.onclick=function(e){e.target!=le&&e.target!=ae||(le.style.display="none")},document.getElementById("privacyLink_sd").addEventListener("click",(function(){document.getElementById("privacyModal_sd").style.display="block"})),document.getElementById("dataProcessingLink_sd").addEventListener("click",(function(){document.getElementById("dataProcessingModal_sd").style.display="block"})),document.getElementById("openAiLink_sd").addEventListener("click",(function(){document.getElementById("openAiModal_sd").style.display="block"}));var ce=document.getElementById("privacyModal_sd"),se=document.getElementById("dataProcessingModal_sd"),re=document.getElementById("openAiModal_sd"),de=document.getElementById("closePrivacy_sd"),ie=document.getElementById("closeDataProcessing_sd"),ue=document.getElementById("closeOpenAi_sd");window.onclick=function(e){e.target!=ce&&e.target!=de||(ce.style.display="none"),e.target!=se&&e.target!=ie||(se.style.display="none"),e.target!=re&&e.target!=ue||(re.style.display="none")},document.getElementById("myForm_sd").addEventListener("submit",(function(e){var t=document.getElementById("privacyCheckbox_sd").checked,n=document.getElementById("dataProcessingCheckbox_sd").checked,o=document.getElementById("openAiCheckbox_sd").checked;t&&n&&o||(e.preventDefault(),alert("Пожалуйста, ознакомьтесь со всеми политиками перед отправкой формы."))})),document.querySelectorAll(".close_sd").forEach((function(e){e.addEventListener("click",(function(){e.closest(".modal_sd").style.display="none"}))}));var me=document.getElementById("butSet"),ge=0,pe=0;me.addEventListener("click",(function(e){e.preventDefault();var t=document.getElementById("name_sd").value,n=document.getElementById("email_sd").value,o=document.getElementById("phone_sd").value,l=document.querySelector('input[name="product_sd"]:checked');l&&l.value;/^([А-Я]{1}[а-яё]{1,23}|[A-Z]{1}[a-z]{1,23})$/.test(t)?console.log("Имя соответствует"):(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Имени!",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),ge=1,console.log("Имя не соответствует требованиям")),/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu.test(n)?console.log("Email соответствует"):(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Email!",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),pe=1,console.log("Email не соответствует требованиям")),!function(e){return/^((8|\+374|\+994|\+995|\+375|\+7|\+380|\+38|\+996|\+998|\+993)[\- ]?)?\(?\d{3,5}\)?[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}[\- ]?\d{1}(([\- ]?\d{1})?[\- ]?\d{1})?$/.test(e)}(o)?(Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, проверьте правильность заполнения \n Телефон",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),1,console.log("Телефон не соответствует требованиям")):console.log("Телефон соответствует");var a=document.getElementById("privacyCheckbox_sd"),c=document.getElementById("dataProcessingCheckbox_sd"),s=document.getElementById("openAiCheckbox_sd"),r=a.checked,d=c.checked,i=s.checked;if(console.log("Состояние privacyCheckbox:",r),console.log("Состояние dataProcessingCheckbox:",d),console.log("Состояние openAiCheckbox:",i),!r||!d||!i)return Toastify({text:"ОШИБКА ВВОДА ДАННЫХ \n Пожалуйста, ознакомтесь с \n политиками сотрудничиства",duration:3e3,close:!0,gravity:"top",position:"center",backgroundColor:"linear-gradient(to right, #FF0000, #FFA500)",stopOnFocus:!0,className:"error-toast",textAlign:"center"}).showToast(),1,void console.log("Политика не соответствует требованиям");1===ge?console.log("Ошибка в имени"):1===pe?console.log("Ошибка в email"):console.log("OK")}))}]);
